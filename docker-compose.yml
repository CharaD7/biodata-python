version: "3"

services:
  python: 
    image: python:3.8
    build:
      context: .
      dockerfile: 'app/docker/python/Dockerfile'
    volumes:
      - './app:/app'
    ports:
      - '8000:8000'
    depends_on:
      - 'rabbitmq'
      - 'celery_worker'

  # rabbit message queue
  rabbitmq:
    image: 'rabbitmq:3.7-alpine'
  # celery worker service
  celery_worker:
    <<: *python:3.8
    command: 'ln -s /run/shm /dev/shm && celery -A biodata worker --loglevel=info'
    ports: [] # Disabling ports to prevevnt port from conflicting with eachother
    depends_on:
      - 'rabbitmq'
  